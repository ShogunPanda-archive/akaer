#!/usr/bin/env ruby
# encoding: utf-8
#
# This file is part of the akaer gem. Copyright (C) 2013 and above Shogun <shogun_panda@me.com>.
# Licensed under the MIT license, which can be found at http://www.opensource.org/licenses/mit-license.php.

require "rubygems"
require "akaer"

Mamertes.App do
  name "Akaer"
  description "A small utility to add aliases to network interfaces."
  version Akaer::Version::STRING

  option "configuration", [], {:type => String, :help => "The configuration file to use. Default is \"~/.akaer_config\".", :default => "~/.akaer_config", :meta => "FILE"}
  option "interface", [], {:type => String, :help => "The default interface to manage. Default is \"lo0\".", :default => "lo0"}
  option "addresses", [], {:type => Array, :help => "The default list of aliases to add. Overrides sequential list"}
  option "start-address", [], {:type => String, :help => "The starting address for sequential aliases. Default is \"10.0.0.1\".", :default => "10.0.0.1", :meta => "ADDRESS"}
  option "aliases", [:S], {:type => Integer, :help => "The number of aliases to add. Default is 5.", :default => 5}
  option "add-command", [:A], {:type => String, :help => "The command to run for adding an alias. Default is \"sudo ifconfig @INTERFACE@ alias @ALIAS@\".", :default => "sudo ifconfig @INTERFACE@ alias @ALIAS@", :meta => "COMMAND"}
  option "remove-command", [:R], {:type => String, :help => "The command to run for removing an alias. Default is \"sudo ifconfig @INTERFACE@ -alias @ALIAS@\".", :default => "sudo ifconfig @INTERFACE@ -alias @ALIAS@", :meta => "COMMAND"}
  option "log-file", [], {:type => String, :help => "The default log file. Default is standard output.", :default => "STDOUT", :meta => "FILE"}
  option "log-level", [:L], {:type => Integer, :help => "The default log level. Valid values are from 0 to 5 where 0 means \"all messages\". Default is 1.", :default => 1, :meta => "LEVEL"}
  option "dry-run", [:n], {:help => "Only show which modifications will be done."}
  option "quiet", [], {:help => "Do not show any message."}

  command :add do
    description "Adds aliases."
    action { |command| Akaer::Application.instance(command).action_add() }
  end

  command :remove do
    description "Removes aliases."
    action { |command| Akaer::Application.instance(command).action_remove() }
  end

  command :install do
    description "Installs the application to autolaunch."
    action { |command| Akaer::Application.instance(command).action_install() }
  end

  command :uninstall do
    description "Uninstalls the application from autolaunch."
    action { |command| Akaer::Application.instance(command).action_uninstall() }
  end

  action do |command|
    self.commands["add"].execute(ARGV)
  end
end